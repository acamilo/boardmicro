<html>
<meta name=viewport content="width=device-width, initial-scale=1">
<style>
  body
  {
    margin: 0;
    padding: 0;
    width: 0;
  }
  img
  {
    margin: 0;
    padding: 0;
    width: 100%;
    height: auto;
  }
</style>
  
<script src="js/avrcore.js"></script>
<script src="js/elfcore.js"></script>
  
<body id="layout">
<div id="sources">
<input text="this" type="file" id="file"/>
</div>
<canvas id="screen"></canvas>
<div id=ports>
<div id="portB" style="display:table;">
<canvas style="width:1px;"></canvas>
<canvas id="B0"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="B1"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="B2"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="B3"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="B4"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="B5"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="B6"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="B7"></canvas>
</div>
<hr style="margin:0">
<div id="portC" style="display:table;">
<canvas style="width:1px;"></canvas>
<canvas id="C0"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="C1"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="C2"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="C3"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="C4"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="C5"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="C6"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="C7"></canvas>
</div>
<hr style="margin:0">
<div id="portD" style="display:table">
<canvas style="width:1px;"></canvas>
<canvas id="D0"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="D1"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="D2"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="D3"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="D4"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="D5"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="D6"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="D7"></canvas>
</div>
<hr style="margin:0">
<div id="portE" style="display:table">
<canvas style="width:1px;"></canvas>
<canvas id="E0"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="E1"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="E2"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="E3"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="E4"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="E5"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="E6"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="E7"></canvas>
</div>
<hr style="margin:0">
<div id="portF" style="display:table">
<canvas style="width:1px;"></canvas>
<canvas id="F0"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="F1"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="F2"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="F3"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="F4"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="F5"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="F6"></canvas>
<canvas style="width:1px;"></canvas>
<canvas id="F7"></canvas>
</div>
</div>
<input style="width:0;" type="search" id="uart" size="33"/>
<details style="display:none" id="debug">
<summary>Debug</summary>
<button onClick="doDebugCommand();">(gdb)</button>
<input type="search" size="15" id="gdb" value="" onkeydown="filterRelevantKeypress()"/>
<font id="gdbshell"></font>
<br/>
<font>Batch Instructions 1 - 300000</font>
<br/>
<input id="batch" onchange="batchSize=this.value" style="width: 99%" type="range" min="1" max="300000" value="1024">
<br/>
<font>Batch Delay 0 - 1000ms</font>
<br/>
<input id="delay" onchange="batchDelay=this.value" style="width: 99%" type="range" min="0" max="1000" value="0">
<br/>
<font>ADC Value 0 - 1023</font>
<br/>
<input id="adc" onchange="adcValue=this.value" style="width: 99%" type="range" min="0" max="1023" value="42">
<br/>
<input type="checkbox" onchange="forceOptimizationEnabled=this.checked"><font>Disable SPI Port Animation</font>
<br/>
<input type="checkbox" onchange="disableUARTInterrupt=this.checked"><font>Disable UART Interrupt</font>
<br/>
</details>
</body>
<script> 

  // Globals

  var B0 = document.getElementById('B0');
  var B1 = document.getElementById('B1');
  var B2 = document.getElementById('B2');
  var B3 = document.getElementById('B3');
  var B4 = document.getElementById('B4');
  var B5 = document.getElementById('B5');
  var B6 = document.getElementById('B6');
  var B7 = document.getElementById('B7');
  var C6 = document.getElementById('C6');
  var C7 = document.getElementById('C7');
  var D0 = document.getElementById('D0');
  var D1 = document.getElementById('D1');
  var D2 = document.getElementById('D2');
  var D3 = document.getElementById('D3');
  var D4 = document.getElementById('D4');
  var D5 = document.getElementById('D5');
  var D6 = document.getElementById('D6');
  var D7 = document.getElementById('D7');
  var E2 = document.getElementById('E2');
  var E6 = document.getElementById('E6');
  var F0 = document.getElementById('F0');
  var F1 = document.getElementById('F1');
  var F4 = document.getElementById('F4');
  var F5 = document.getElementById('F5');
  var F6 = document.getElementById('F6');
  var F7 = document.getElementById('F7');

  var layout = document.getElementById('layout');
  var screen_canvas = document.getElementById("screen");
  var uart = document.getElementById("uart");
  var debug = document.getElementById("debug");
  var sources = document.getElementById("sources");
  var ports = document.getElementById("ports");
  var file_input = document.getElementById('file');
  var red_color = "#FF0000";
  var green_color = "#00FF00"
  var default_color = "#626269";
  var screen_buffer = document.createElement("canvas");
  var screen_driver = document.createElement("script");
  var gdb_window = document.getElementById("gdb");
  var result_window = document.getElementById("gdbshell");

  // Platform specific
  var num_ports = 5
  var port_width = 8;

  var max_width = 400;
  var max_height = 480; // Currently short circuited below

  var width = screen.width > max_width ? max_width: screen.width;
  var height = screen.height > max_height ?  screen.height: screen.height;

  var commandHistory = [];
  var historyIndex = -1;

</script>
<script src="js/scratch.js"></script>
<script src="js/lib.js"></script>
<script>

  // Essential layout functions
  layout.style.width = width;
  uart.style.width = width;
  var uart_height = normalize(height/25, 2);
  uart.style.height = uart_height;
  debug.style.background = default_color;
  debug.style.width = width;
  sources.style.background = default_color;
  var sources_height = normalize(height/21, 2);
  sources.style.height = sources_height;
  var screen_height = initScreen();
  fillCanvas(screen_canvas,"black");
  fillCanvas(screen_buffer,"black");
  var port_height = normalize((height-screen_height-uart_height-sources_height)/num_ports, 2);
  initPorts(port_height);
  setupActivePorts();
  setupInactivePorts();
  initFileInput();

</script>
</html>
